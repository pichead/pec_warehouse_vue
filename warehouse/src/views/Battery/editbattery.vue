
<style>
    .paginationjs{line-height:1.6;font-family:Marmelad,"Lucida Grande",Arial,"Hiragino Sans GB",Georgia,sans-serif;font-size:14px;box-sizing:initial}.paginationjs:after{display:table;content:" ";clear:both}.paginationjs .paginationjs-pages{float:left}.paginationjs .paginationjs-pages ul{float:left;margin:0;padding:0}.paginationjs .paginationjs-go-button,.paginationjs .paginationjs-go-input,.paginationjs .paginationjs-nav{float:left;margin-left:10px;font-size:14px}.paginationjs .paginationjs-pages li{float:left;border:1px solid #aaa;border-right:none;list-style:none}.paginationjs .paginationjs-pages li>a{min-width:30px;height:28px;line-height:28px;display:block;background:#fff;font-size:14px;color:#333;text-decoration:none;text-align:center}.paginationjs .paginationjs-pages li>a:hover{background:#eee}.paginationjs .paginationjs-pages li.active{border:none}.paginationjs .paginationjs-pages li.active>a{height:30px;line-height:30px;background:#aaa;color:#fff}.paginationjs .paginationjs-pages li.disabled>a{opacity:.3}.paginationjs .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs .paginationjs-pages li:first-child,.paginationjs .paginationjs-pages li:first-child>a{border-radius:3px 0 0 3px}.paginationjs .paginationjs-pages li:last-child{border-right:1px solid #aaa;border-radius:0 3px 3px 0}.paginationjs .paginationjs-pages li:last-child>a{border-radius:0 3px 3px 0}.paginationjs .paginationjs-go-input>input[type=text]{width:30px;height:28px;background:#fff;border-radius:3px;border:1px solid #aaa;padding:0;font-size:14px;text-align:center;vertical-align:baseline;outline:0;box-shadow:none;box-sizing:initial}.paginationjs .paginationjs-go-button>input[type=button]{min-width:40px;height:30px;line-height:28px;background:#fff;border-radius:3px;border:1px solid #aaa;text-align:center;padding:0 8px;font-size:14px;vertical-align:baseline;outline:0;box-shadow:none;color:#333;cursor:pointer;vertical-align:middle\9}.paginationjs.paginationjs-theme-blue .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-blue .paginationjs-pages li{border-color:#289de9}.paginationjs .paginationjs-go-button>input[type=button]:hover{background-color:#f8f8f8}.paginationjs .paginationjs-nav{height:30px;line-height:30px}.paginationjs .paginationjs-go-button,.paginationjs .paginationjs-go-input{margin-left:5px\9}.paginationjs.paginationjs-small{font-size:12px}.paginationjs.paginationjs-small .paginationjs-pages li>a{min-width:26px;height:24px;line-height:24px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-pages li.active>a{height:26px;line-height:26px}.paginationjs.paginationjs-small .paginationjs-go-input{font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-input>input[type=text]{width:26px;height:24px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-button{font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-button>input[type=button]{min-width:30px;height:26px;line-height:24px;padding:0 6px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-nav{height:26px;line-height:26px;font-size:12px}.paginationjs.paginationjs-big{font-size:16px}.paginationjs.paginationjs-big .paginationjs-pages li>a{min-width:36px;height:34px;line-height:34px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-pages li.active>a{height:36px;line-height:36px}.paginationjs.paginationjs-big .paginationjs-go-input{font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-input>input[type=text]{width:36px;height:34px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-button{font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-button>input[type=button]{min-width:50px;height:36px;line-height:34px;padding:0 12px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-nav{height:36px;line-height:36px;font-size:16px}.paginationjs.paginationjs-theme-blue .paginationjs-pages li>a{color:#289de9}.paginationjs.paginationjs-theme-blue .paginationjs-pages li>a:hover{background:#e9f4fc}.paginationjs.paginationjs-theme-blue .paginationjs-pages li.active>a{background:#289de9;color:#fff}.paginationjs.paginationjs-theme-blue .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-blue .paginationjs-go-button>input[type=button]{background:#289de9;border-color:#289de9;color:#fff}.paginationjs.paginationjs-theme-green .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-green .paginationjs-pages li{border-color:#449d44}.paginationjs.paginationjs-theme-blue .paginationjs-go-button>input[type=button]:hover{background-color:#3ca5ea}.paginationjs.paginationjs-theme-green .paginationjs-pages li>a{color:#449d44}.paginationjs.paginationjs-theme-green .paginationjs-pages li>a:hover{background:#ebf4eb}.paginationjs.paginationjs-theme-green .paginationjs-pages li.active>a{background:#449d44;color:#fff}.paginationjs.paginationjs-theme-green .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-green .paginationjs-go-button>input[type=button]{background:#449d44;border-color:#449d44;color:#fff}.paginationjs.paginationjs-theme-yellow .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-yellow .paginationjs-pages li{border-color:#ec971f}.paginationjs.paginationjs-theme-green .paginationjs-go-button>input[type=button]:hover{background-color:#55a555}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li>a{color:#ec971f}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li>a:hover{background:#fdf5e9}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li.active>a{background:#ec971f;color:#fff}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-yellow .paginationjs-go-button>input[type=button]{background:#ec971f;border-color:#ec971f;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-red .paginationjs-pages li{border-color:#c9302c}.paginationjs.paginationjs-theme-yellow .paginationjs-go-button>input[type=button]:hover{background-color:#eea135}.paginationjs.paginationjs-theme-red .paginationjs-pages li>a{color:#c9302c}.paginationjs.paginationjs-theme-red .paginationjs-pages li>a:hover{background:#faeaea}.paginationjs.paginationjs-theme-red .paginationjs-pages li.active>a{background:#c9302c;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-red .paginationjs-go-button>input[type=button]{background:#c9302c;border-color:#c9302c;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-go-button>input[type=button]:hover{background-color:#ce4541}.paginationjs .paginationjs-pages li.paginationjs-next{border-right:1px solid #aaa\9}.paginationjs .paginationjs-go-input>input[type=text]{line-height:28px\9;vertical-align:middle\9}.paginationjs.paginationjs-big .paginationjs-pages li>a{line-height:36px\9}.paginationjs.paginationjs-big .paginationjs-go-input>input[type=text]{height:36px\9;line-height:36px\9}

    body{margin-top:20px;}
.timeline {
    border-left: 3px solid #898b94;
    border-bottom-right-radius: 4px;
    border-top-right-radius: 4px;
    /* background: rgba(114, 124, 245, 0.09); */
    /* margin: 0 auto; */
    letter-spacing: 0.2px;
    position: relative;
    line-height: 1.4em;
    font-size: 1.03em;
    padding: 50px;
    list-style: none;
    text-align: left;
    max-width: 100%;
}

@media (max-width: 1000px) {
    .timeline {
        max-width: 98%;
        padding: 25px;
    }
}



.timeline .event {
    border-bottom: 1px dashed #e8ebf1;
    padding-bottom: 25px;
    margin-bottom: 25px;
    position: relative;
}

@media (max-width: 767px) {
    .timeline .event {
        padding-top: 30px;
    }
}

.timeline .event:last-of-type {
    padding-bottom: 0;
    margin-bottom: 0;
    border: none;
}

.timeline .event:before,
.timeline .event:after {
    position: absolute;
    display: block;
    top: 0;
}

.timeline .event:before {
    left: -207px;
    content: attr(data-date);
    text-align: right;
    font-weight: 100;
    font-size: 0.9em;
    min-width: 120px;
}

@media (max-width: 767px) {
    .timeline .event:before {
        left: 0px;
        text-align: left;
    }
}

.timeline .event:after {
    -webkit-box-shadow: 0 0 0 3px #898b94;
    box-shadow: 0 0 0 3px #898b94;
    left: -55.8px;
    background: #898b94;
    border-radius: 50%;
    height: 9px;
    width: 9px;
    content: "";
    top: 5px;
}

@media (max-width: 1000px) {
    .timeline .event:after {
        left: -31.8px;
    }
}

.rtl .timeline {
    border-left: 0;
    text-align: right;
    border-bottom-right-radius: 0;
    border-top-right-radius: 0;
    border-bottom-left-radius: 4px;
    border-top-left-radius: 4px;
    border-right: 3px solid #727cf5;
}

.rtl .timeline .event::before {
    left: 0;
    right: -170px;
}

.rtl .timeline .event::after {
    left: 0;
    right: -55.8px;
}


</style>
<template>

<Sidebar />
    <div id="content" style="margin-left: 250px">
        <div class="container">
            
            <div class="row mt-5 mb-4">
                <div class="h3 font-weight-bold col-10">รายละเอียดแบตเตอร์รี่</div>
                <a class="btn btn-info col " href="/Battery/batterylist">Back</a>
            </div>

            <!-- <div class="modal" id="editStatus">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">แก้ไขสถานะสินค้า</h5>
                            <button class="close" data-dismiss="modal">×</button>
                        </div>
                        <div class="modal-body">
                            <select id="statusList" class="form-control" required>
                                <option selected disabled>สถานะสินค้า</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button id="editSubmit" class="btn btn-primary" >ยืนยัน</button>
                            <button class="btn btn-danger" data-dismiss="modal">ยกเลิก</button>

                        </div>
                    </div>
                </div>
            </div> -->

            <div class="col-10 mx-auto p-5 border">
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">Barcode</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="barcode">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">ประเภทสินค้า</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="type">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">PEC PO</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="pecpo">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">รุ่น</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="serie">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">Job No.</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="jobno">
                        </div>
                    </div>

                </div>
                <div class="col-12 border my-5"></div>

                <div class="h4 text-center mb-4">รายละเอียดการติดตั้ง</div>
                
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">UPS Name</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="upsname">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">BMS</div>
                        <div class="col-7" id="bms">
                            <!-- <input class="form-control-sm" id="bms"> -->
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">UPS Brand</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="upsbrand">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">Site</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="site">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">UPS Series</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="upsserie">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">Building</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="building">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">KVA</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="kva">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">Room</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="room">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">Total String</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="totalstring">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">ติดตั้งเสร็จ</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="installdate">
                        </div>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 row">
                        <div class="col-5">Total blk/str</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="totalblk">
                        </div>
                    </div>
                    <div class="col-6 row">
                        <div class="col-5">ผู้รับผิดชอบ</div>
                        <div class="col-7">
                            <input class="form-control-sm" id="inspector">
                        </div>
                    </div>
                </div>

                <div class="col-12 border my-5"></div>

                <div class="h4 text-center mb-4">Timeline - History</div>
                <div class="mx-auto col-10">

                        <ul class="timeline" id="timeline">
                        </ul>
                        
                
                </div>
            </div>

            
        </div>
    </div>
</template>

<script>
import { projectFirestore, projectAuth } from "../../firebase/config";
import pagination from '../../assets/pagination'

import Sidebar from "../../components/Sidebar.vue";
import router from "@/router";
export default {
    components: { Sidebar },
    mounted() {
        var url = window.location.pathname;
        var id = url.substring(url.lastIndexOf('/') + 1);
        // var productId = this.$route.params.productId
        var dataid = id


        projectFirestore.collection("Batteries").doc(dataid).get().then((battery) => {
            showdata(battery)
        })

        function showdata  (battery){
            // var dt=eval(battery.data().siteLocations[0].installationDate.seconds*1000);
            // var myDate = new Date(dt);
            var orderdate = new Date(battery.data().siteLocations[0].installationDate.seconds*1000).toLocaleDateString("th-TH")
            // console.log(orderdate)
            $('#barcode').val(battery.data().barcode)
            $('#type').val(battery.data().type)
            $('#pecpo').val(battery.data().customerPurchaseOrder)
            $('#serie').val(battery.data().series)
            $('#jobno').val(battery.data().jobNo)
            $('#upsname').val(battery.data().siteLocations[0].system)
            // $('#bms').val(battery.data().siteLocations[0].BMS)
            if(battery.data().siteLocations[0].BMS == true){
                $('#bms').append(
                    '<div class="custom-control custom-radio custom-control-inline">'+
                        '<input type="radio" id="option0show" name="showoption0" value="true" class="custom-control-input optionshow" checked="checked">'+
                        '<label class="custom-control-label" for="option0show">Yes</label>'+
                    '</div>'+
                    '<div class="custom-control custom-radio custom-control-inline">'+
                        '<input type="radio" id="option0hidden" name="showoption0" class="custom-control-input optionshow" value="false" >'+
                        '<label class="custom-control-label" for="option0hidden">No</label>'+
                    '</div>'
                )
            }else{
                $('#bms').append(
                    '<div class="custom-control custom-radio custom-control-inline">'+
                        '<input type="radio" id="option0show" name="showoption0" value="true" class="custom-control-input optionshow" >'+
                        '<label class="custom-control-label" for="option0show">Yes</label>'+
                    '</div>'+
                    '<div class="custom-control custom-radio custom-control-inline">'+
                        '<input type="radio" id="option0hidden" name="showoption0" class="custom-control-input optionshow" value="false" checked="checked">'+
                        '<label class="custom-control-label" for="option0hidden">No</label>'+
                    '</div>'
                )
            }
            
            $('#upsbrand').val(battery.data().brand)
            $('#site').val(battery.data().siteLocations[0].site)
            $('#upsserie').val(battery.data().series)
            $('#building').val(battery.data().siteLocations[0].building)
            $('#kva').val(battery.data().siteLocations[0].ups_kva)
            $('#room').val(battery.data().siteLocations[0].room)
            $('#totalstring').val(battery.data().siteLocations[0].totalStrings)
            $('#installdate').val(orderdate)
            $('#totalblk').val(battery.data().siteLocations[0].blockPerString)
            $('#inspector').val(battery.data().siteLocations[0].inspector)

            console.log(battery.data().statusItems.length)
            for(let i = 0; i < battery.data().statusItems.length; i++){
                var statusdate = new Date(battery.data().statusItems[i].timestamp*1000)
                var localDate = statusdate.toLocaleDateString("th-TH")
                var hours = statusdate.getHours();
                var minutes = "0" + statusdate.getMinutes();
                var seconds = "0" + statusdate.getSeconds();
                var formattedTime = hours + ':' + minutes.substr(-2);

                projectFirestore.collection("StatusItems").doc(battery.data().statusItems[i].id).get().then((status) => {
                  
                    $("#timeline").append(
                        '<li class="event" data-date="">'+
                            '<h5>'+localDate+' '+formattedTime+'\xa0\xa0\xa0'+'-'+'\xa0\xa0\xa0'+status.data().name+'</h5>'+
                            '<div style="padding-left:200px">'+battery.data().statusItems[i].location+'</div>'+
                        '</li>'
                    )

                })
            }
            


        }

    },
    data() {
        return {
        option: 1,
        totalItem: 1,
        };
    },
    methods: {
        
    },
}
</script>